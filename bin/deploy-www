#!/usr/bin/env bash

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"

set -x

REPOSITORY=docker.repo1.uhc.com/optumassistant/ui-components
TAG=latest

if [[ ! -z "$LOGIN" ]]; then
  kubectl config set-cluster osfi_k8s_elr --server=https://10.49.2.252:6443 --certificate-authority=deployment/kubernetes/ca_elr.crt
  kubectl config set-credentials cds-platform-sa --token=$SECRET
  kubectl config set-context cds-platform --cluster=osfi_k8s_elr --namespace=cds-platform --user=cds-platform-sa
  kubectl config use-context cds-platform
fi

(
helm upgrade --install --force \
  --namespace cds-platform \
  --set image.repository=$REPOSITORY \
  --set image.tag=$TAG \
  ui-components \
  $DIR/../helm/website
)
